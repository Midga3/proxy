# Telegram SOCKS5 Proxy

Автоматический SOCKS5 прокси для Telegram, который подключается к прокси из публичного списка с минимальным пингом.

## Описание

Этот скрипт создает локальный SOCKS5 прокси-сервер, который:
- Загружает актуальный список SOCKS5 прокси из GitHub
- Фильтрует прокси с пингом меньше 300ms
- Выбирает случайный прокси из отфильтрованного списка
- Автоматически обновляет список каждые 10 минут
- Перенаправляет весь трафик через выбранный upstream прокси

## Требования

- Python 3.7+
- Стандартные библиотеки Python (asyncio, json, socket, urllib)

## Установка

1. Клонируйте репозиторий или скачайте файл `tg_socks5_proxy.py`

2. Убедитесь, что у вас установлен Python 3.7 или новее:
```bash
python --version
```

## Использование

### Запуск прокси

```bash
python tg_socks5_proxy.py
```

После запуска вы увидите:
```
[2025-10-22 12:00:00] ============================================================
[2025-10-22 12:00:00] Telegram SOCKS5 Proxy
[2025-10-22 12:00:00] ============================================================
[2025-10-22 12:00:00] Загрузка списка прокси из https://raw.githubusercontent.com/...
[2025-10-22 12:00:00] Загружено 25 прокси с пингом < 300ms из 50 всего
[2025-10-22 12:00:00] Выбран прокси: 185.175.58.113:1080 (страна: AT, пинг: 107ms, провайдер: HOSTHATCH)
[2025-10-22 12:00:00] ============================================================
[2025-10-22 12:00:00] SOCKS5 прокси запущен на 127.0.0.1:1080
[2025-10-22 12:00:00] Upstream прокси: 185.175.58.113:1080
[2025-10-22 12:00:00] ============================================================
```

### Настройка Telegram

#### Desktop версия (Windows/Mac/Linux)
1. Откройте Telegram Desktop
2. Перейдите в Settings → Advanced → Connection type
3. Выберите "Use custom proxy"
4. Выберите SOCKS5
5. Укажите параметры:
   - **Server**: `127.0.0.1`
   - **Port**: `1080`
   - **Username**: (оставьте пустым)
   - **Password**: (оставьте пустым)
6. Нажмите "Save"

#### Mobile версия (Android/iOS)
1. Откройте настройки Telegram
2. Перейдите в Data and Storage → Proxy Settings
3. Добавьте SOCKS5 прокси:
   - **Server**: `127.0.0.1`
   - **Port**: `1080`
4. Включите прокси

## Настройка

Вы можете изменить настройки в начале файла `tg_socks5_proxy.py`:

```python
# Конфигурация
PROXY_LIST_URL = "https://raw.githubusercontent.com/hookzof/socks5_list/refs/heads/master/tg/socks.json"
MAX_PING = 300  # Максимальный пинг в миллисекундах
LOCAL_HOST = "127.0.0.1"  # Адрес для прослушивания
LOCAL_PORT = 1080  # Локальный порт
UPDATE_INTERVAL = 600  # Обновлять список каждые 10 минут
BUFFER_SIZE = 8192  # Размер буфера для передачи данных
```

### Примеры настройки

**Изменить максимальный пинг на 200ms:**
```python
MAX_PING = 200
```

**Изменить локальный порт на 1085:**
```python
LOCAL_PORT = 1085
```

**Разрешить подключения из локальной сети:**
```python
LOCAL_HOST = "0.0.0.0"  # ВНИМАНИЕ: это может быть небезопасно!
```

## Особенности

- ✅ Автоматический выбор быстрых прокси (пинг < 300ms)
- ✅ Автоматическое обновление списка прокси
- ✅ Поддержка IPv4 и IPv6
- ✅ Асинхронная обработка соединений
- ✅ Минимальные зависимости (только стандартная библиотека Python)
- ✅ Подробное логирование

## Тестирование

После запуска прокси вы можете проверить его работоспособность:

```bash
python test_proxy.py
```

Тест проверит:
- ✅ Подключение к локальному прокси
- ✅ SOCKS5 handshake
- ✅ Подключение через прокси к Telegram серверам
- ✅ Передачу данных

Если тест успешен, вы увидите:
```
✓ Прокси работает корректно!

Вы можете использовать его в Telegram:
  Сервер: 127.0.0.1
  Порт: 1080
  Тип: SOCKS5
```

## Устранение неполадок

### Прокси не подключается
- Проверьте, что скрипт запущен и не завершился с ошибкой
- Запустите `python test_proxy.py` для диагностики
- Убедитесь, что порт 1080 не занят другим приложением
- Попробуйте перезапустить скрипт (выбранный прокси может быть недоступен)

### Нет прокси с пингом < 300ms
- Увеличьте значение `MAX_PING` в настройках
- Проверьте доступность источника списка прокси

### Telegram не подключается через прокси
- Проверьте правильность настроек в Telegram
- Убедитесь, что указали правильный адрес (`127.0.0.1`) и порт (`1080`)
- Перезапустите Telegram

## Безопасность

⚠️ **Важно**: Бесплатные публичные прокси могут быть небезопасны:
- Не передавайте через них конфиденциальную информацию
- Используйте только для обхода блокировок Telegram
- Рекомендуется использовать VPN для дополнительной безопасности

## Лицензия

Этот проект предоставляется "как есть" без каких-либо гарантий.

## Источники

- Список прокси: [hookzof/socks5_list](https://github.com/hookzof/socks5_list)
- Пример MTProto прокси: [alexbers/mtprotoproxy](https://github.com/alexbers/mtprotoproxy)

